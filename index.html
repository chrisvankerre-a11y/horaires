<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Planning hebdomadaire d'équipe</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

  <h1>Planning hebdomadaire d'équipe</h1>

  <!-- STAFF -->
  <fieldset class="no-print">
    <legend>1. Staff disponible</legend>
    <label for="staffCount">Nombre de personnes :</label>
    <input type="number" id="staffCount" min="0" value="0" readonly>
    <button type="button" onclick="resetStaff()">Reset / réinitialiser</button>
    <button type="button" onclick="exportStaff()">Exporter la liste du staff</button>
    <button type="button" onclick="document.getElementById('importStaffFile').click()">Importer une liste du staff</button>
    <button type="button" onclick="clearAllData()">Tout effacer</button>

    <div id="staffTableContainer" class="small"></div>
    <p class="small">
      Les noms encodés dans les créneaux doivent correspondre <strong>exactement</strong>
      à un nom de cette liste. L'autocomplétion te propose les noms existants.
    </p>

    <!-- Datalist utilisée pour l'autocomplétion dans les créneaux -->
    <datalist id="staffDatalist"></datalist>
  </fieldset>

  <!-- CRENEAUX / BESOINS PAR JOUR -->
  <fieldset class="no-print">
    <legend>2. Configuration des besoins / créneaux</legend>

    <div class="small" style="margin-bottom:8px;">
      <button type="button" onclick="setSlotsConfigMode('manual')">Mode créneaux manuels</button>
      <button type="button" onclick="setSlotsConfigMode('needs')">Mode besoins horaires</button>
    </div>

    <!-- Mode créneaux manuels (identique à avant) -->
    <div id="manualSlotsWrapper">
      <p class="small">
        Format du libellé attendu : <code>HH:MM-HH:MM</code> (ex : <code>08:00-12:30</code>).<br>
        La durée est calculée automatiquement à partir de ce libellé.
      </p>

      <div style="margin-bottom:8px;">
        <button type="button" onclick="exportWeekSlots()">Exporter tous les créneaux de la semaine</button>
        <button type="button" onclick="document.getElementById('importWeekFile').click()">Importer des créneaux pour la semaine complète</button>
      </div>

      <div id="daysConfigContainer"></div>
    </div>

    <!-- Mode besoins horaires -->
    <div id="needsWrapper" style="display:none;">
      <p class="small">
        Indique pour chaque jour et chaque pas horaire le <strong>nombre de personnes nécessaires</strong>.<br>
        Ensuite clique sur « Générer les créneaux à partir des besoins » pour construire automatiquement la liste de créneaux.
      </p>

      <div style="margin-bottom:8px;">
        <label for="needsResolutionSelect">Pas temporel :</label>
        <select id="needsResolutionSelect" onchange="onNeedsResolutionChange()">
          <option value="60">1 heure</option>
          <option value="30" selected>30 minutes</option>
        </select>

        <button type="button" onclick="exportWeekNeeds()">Exporter les besoins horaires</button>
        <button type="button" onclick="document.getElementById('importWeekNeedsFile').click()">Importer des besoins horaires</button>
        <button type="button" onclick="generateSlotsFromNeeds()">Générer les créneaux à partir des besoins</button>
      </div>

      <div id="needsDaysContainer" class="small"></div>
    </div>
  </fieldset>

  <!-- CALENDRIER + STATS -->
  <fieldset>
    <legend>3. Calendrier hebdomadaire et synthèse</legend>

    <div class="no-print">
      <button type="button" onclick="generateCalendar()">Générer / régénérer le planning hebdomadaire</button>
      <button type="button" onclick="autoFillAssignments()">Répartition automatique (naïve)</button>
      <button type="button" onclick="resetAssignments()">Réinitialiser les affectations</button>
      <button type="button" onclick="window.print()">Imprimer / Export PDF</button>
      <p class="small">
        Dans chaque créneau, tape le nom d'une personne dans la première case (autocomplétion).<br>
        Dès que la dernière case est remplie, une nouvelle case vide apparaît automatiquement.
        Cliquer à nouveau sur « Générer » conserve les affectations existantes quand c'est possible.
      </p>
    </div>

    <div class="no-print" style="margin-top:10px;margin-bottom:6px;">
      <button type="button" onclick="setScheduleView('slots')">Vue par créneaux</button>
      <button type="button" onclick="setScheduleView('timeline')">Vue horaire détaillée</button>
      <button type="button" onclick="setScheduleView('person')">Vue horaire par personne</button>
      <span style="margin-left:10px;">
        Personne :
        <select id="personViewSelect" onchange="onPersonViewChange()">
          <option value="">-- choisir --</option>
        </select>
      </span>
    </div>

    <h2 id="slotsTitle" style="font-size:16px;">Grille hebdomadaire (vue par créneaux)</h2>
    <div id="scheduleContainer" class="small"></div>

    <h2 id="timelineTitle" style="font-size:16px; margin-top:16px; display:none;">
      Grille hebdomadaire (vue horaire détaillée 5h → 5h)
    </h2>
    <div id="scheduleTimelineContainer" class="small" style="display:none"></div>

    <h2 id="personTimelineTitle" style="font-size:16px; margin-top:16px; display:none;">
      Grille horaire d'une personne (5h → 5h)
    </h2>
    <div id="personTimelineContainer" class="small" style="display:none"></div>

    <h2 style="font-size:16px;">Heures par personne</h2>
    <div id="hoursSummaryContainer" class="small"></div>

    <h2 style="font-size:16px;">Avertissements</h2>
    <div id="slotWarningsContainer" class="small"></div>
  </fieldset>

  <!-- Inputs cachés pour import -->
  <input type="file" id="importStaffFile" accept=".json,application/json" style="display:none" onchange="handleImportStaffFile(event)">
  <input type="file" id="importDayFile" accept=".json,application/json" style="display:none" onchange="handleImportDayFile(event)">
  <input type="file" id="importWeekFile" accept=".json,application/json" style="display:none" onchange="handleImportWeekFile(event)">
  <input type="file" id="importWeekNeedsFile" accept=".json,application/json" style="display:none" onchange="handleImportWeekNeedsFile(event)">
  <input type="file" id="importNeedsDayFile" accept=".json,application/json" style="display:none" onchange="handleImportNeedsDayFile(event)">

  <script src="script.js"></script>
  <div id="notification-container"></div>
</body>
</html>